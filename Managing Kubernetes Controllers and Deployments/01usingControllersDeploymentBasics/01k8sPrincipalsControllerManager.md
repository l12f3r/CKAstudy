# Using Controllers to deploy applications and Deployment basics

### Kubernetes principals
- Desired state with a declarative configuration
    - Requirements are defined in code, and Kubernetes provisions based on this code
- **Controllers**
    - Keeps application/deployment on the desired state
    - Watches current state of cluster and, if needed, makes changes (scaling up or down, for instance) to reach the desired state
    - Further info: 
- API Server
    - Core information hub inside of Kubernetes
    - Where administrators interact with the cluster (using Controllers, for instance)

### Controller Manager among other Control Plane ðŸ§  components
- Further info in [Kubernetes Installation and Configuration Fundamentals](07k8sClusterComponents.md#control-plane-node-components)
- The **Controller Manager** interacts with the API Server to ensure that the desired state is maintained
    - By implementing the [lifecycle function](../../Managing%20the%20Kubernetes%20API%20Server%20and%20Pods/03runningManagingPods/02podLifecycle.md) of Controllers

## Controller Manager
- Two different types of Controller Managers:
    - `kube-controller-manager`: responsible for running core controllers, keeping cluster on desired state
        - By using Control Loops
            - Executes and supports Deployments, ReplicaSets, Service endpoints etc
        - One per cluster
    - `cloud-controller-manager`: cloud-specific controller manager that enables cloud providers to build Controllers specific to their environments
        - Interacts with underlying cloud infrastructure (load balancers, network routes, volume controllers etc)

### Controller Operations
1. Controller watches cluster state through the API Server and makes changes to move the current state to desired
2. Any operation to move to desired state is generated by Controller and submitted to API Server
3. API Server handles request and, if needed, persists change to etcd

## Controllers in Kubernetes
- Controllers that control **Pods**:
    - `ReplicaSet`: deploys and maintains a defined number of Pods from a Pod template (definition of what container image must be executed and its configuration)
    - `Deployment`: allows declarative updates of Pods and ReplicaSets, enabling to move between versions of container images and easily scale and manage applications
    - `DaemonSet`: ensures that all (or some) Nodes run a Pod (i.e., the kubeproxy for networking services inside of the cluster, log collectors, monitoring agents). Runs on each Node
    - `StatefulSet`: allows stateful applications to be managed by a Controller providing unique network names, persistent storage and ordered operations for scaling and rolling updates
    - `Job`: creates one or more Pods and ensures that a defined number of those Pods successfully terminates (good for batch workloads)
    - `CronJob`: creates and manages `Jobs` based on a defined schedule
- Core Controllers that control **Other Controllers**
    - `Node`: monitors state of Nodes
    - `Service`: manages creation and deletion of load balancers from infrastructure
    - `Endpoint`: updates and manages Service endpoints for Pods and Services based on label selectors defined

###### Return to [Summary](README.md)